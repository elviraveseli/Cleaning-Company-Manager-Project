<div class="customer-form-container">
  <!-- Form Header -->
  <div class="form-header">
    <h1>{{ isEditMode ? "Edit" : "New" }} Customer</h1>
    <p>
      {{
        isEditMode
          ? "Update customer information"
          : "Add a new customer to your system"
      }}
    </p>
  </div>

  <!-- Main Form Content -->
  <div class="form-content">
    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner diameter="40"></mat-spinner>
      <span>Loading customer details...</span>
    </div>

    <form [formGroup]="customerForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">
      <!-- Basic Information Section -->
      <div class="form-section">
        <div class="section-header">
          <h2>Basic Information</h2>
          <mat-icon class="section-icon">person</mat-icon>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input
              matInput
              formControlName="firstName"
              required
              placeholder="Enter first name"
            />
            <mat-error>{{ getErrorMessage("firstName") }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input
              matInput
              formControlName="lastName"
              required
              placeholder="Enter last name"
            />
            <mat-error>{{ getErrorMessage("lastName") }}</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input
              matInput
              formControlName="email"
              type="email"
              required
              placeholder="Enter email address"
            />
            <mat-icon matPrefix>email</mat-icon>
            <mat-error>{{ getErrorMessage("email") }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Phone</mat-label>
            <input
              matInput
              formControlName="phone"
              required
              placeholder="Enter phone number"
            />
            <mat-icon matPrefix>phone</mat-icon>
            <mat-error>{{ getErrorMessage("phone") }}</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Company</mat-label>
            <input
              matInput
              formControlName="company"
              placeholder="Enter company name (optional)"
            />
            <mat-icon matPrefix>business</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Customer Type</mat-label>
            <mat-select formControlName="customerType" required>
              <mat-option *ngFor="let type of customerTypes" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
            <mat-error>{{ getErrorMessage("customerType") }}</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select formControlName="status" required>
              <mat-option *ngFor="let status of statusTypes" [value]="status">
                {{ status }}
              </mat-option>
            </mat-select>
            <mat-error>{{ getErrorMessage("status") }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Preferred Contact Method</mat-label>
            <mat-select formControlName="preferredContactMethod" required>
              <mat-option
                *ngFor="let method of contactMethods"
                [value]="method"
              >
                {{ method }}
              </mat-option>
            </mat-select>
            <mat-error>{{
              getErrorMessage("preferredContactMethod")
            }}</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Address Information Section -->
      <div class="form-section">
        <div class="section-header">
          <h2>Service Address</h2>
          <mat-icon class="section-icon">location_on</mat-icon>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Street Address</mat-label>
            <input
              matInput
              formControlName="address"
              required
              placeholder="Enter street address"
            />
            <mat-error>{{ getErrorMessage("address") }}</mat-error>
          </mat-form-field>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input
              matInput
              formControlName="city"
              required
              placeholder="Enter city"
            />
            <mat-error>{{ getErrorMessage("city") }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Municipality</mat-label>
            <mat-select formControlName="municipality" required>
              <mat-option
                *ngFor="let municipality of municipalities"
                [value]="municipality"
              >
                {{ municipality }}
              </mat-option>
            </mat-select>
            <mat-error>{{ getErrorMessage("municipality") }}</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Emergency Contact Section -->
      <div class="form-section">
        <div class="section-header">
          <h2>Emergency Contact</h2>
          <mat-icon class="section-icon">contact_emergency</mat-icon>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Contact Name</mat-label>
            <input
              matInput
              formControlName="emergencyContactName"
              placeholder="Enter emergency contact name"
            />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Contact Phone</mat-label>
            <input
              matInput
              formControlName="emergencyContactPhone"
              placeholder="Enter emergency contact phone"
            />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Relationship</mat-label>
            <input
              matInput
              formControlName="emergencyContactRelationship"
              placeholder="Enter relationship"
            />
          </mat-form-field>
        </div>
      </div>

      <!-- Billing Information Section -->
      <div class="form-section">
        <div class="section-header">
          <h2>Billing Information</h2>
          <mat-icon class="section-icon">payment</mat-icon>
        </div>
        <div class="form-row">
          <mat-checkbox
            formControlName="hasSeparateBillingAddress"
            class="checkbox-field"
          >
            Use separate billing address
          </mat-checkbox>
        </div>
        <div
          *ngIf="customerForm.get('hasSeparateBillingAddress')?.value"
          class="billing-address-section"
        >
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Billing Street Address</mat-label>
              <input
                matInput
                formControlName="billingAddress"
                placeholder="Enter billing street address"
              />
            </mat-form-field>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Billing City</mat-label>
              <input
                matInput
                formControlName="billingCity"
                placeholder="Enter billing city"
              />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Billing Municipality</mat-label>
              <mat-select formControlName="billingMunicipality">
                <mat-option
                  *ngFor="let municipality of municipalities"
                  [value]="municipality"
                >
                  {{ municipality }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Additional Information Section -->
      <div class="form-section">
        <div class="section-header">
          <h2>Additional Information</h2>
          <mat-icon class="section-icon">notes</mat-icon>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Notes</mat-label>
            <textarea
              matInput
              formControlName="notes"
              rows="3"
              placeholder="Enter any additional notes"
            ></textarea>
          </mat-form-field>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          mat-stroked-button
          (click)="onCancel()"
          [disabled]="isSaving"
        >
          <mat-icon>arrow_back</mat-icon>
          Cancel
        </button>
        <button
          type="submit"
          mat-raised-button
          color="primary"
          [disabled]="customerForm.invalid || isSaving"
        >
          <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!isSaving">save</mat-icon>
          {{ isEditMode ? "Update Customer" : "Create Customer" }}
        </button>
      </div>
    </form>
  </div>
</div>
