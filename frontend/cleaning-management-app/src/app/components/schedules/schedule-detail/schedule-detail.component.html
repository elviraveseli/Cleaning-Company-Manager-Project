<h2 mat-dialog-title>{{ isEdit ? "Edit Schedule" : "Create New Schedule" }}</h2>

<div class="schedule-detail-container">
  <div class="detail-content">
    <form [formGroup]="scheduleForm" (ngSubmit)="onSubmit()">
      <mat-dialog-content>
        <div class="form-grid">
          <!-- Object Selection -->
          <mat-form-field>
            <mat-label>Location</mat-label>
            <mat-select formControlName="object" [compareWith]="compareObjects">
              <mat-option *ngFor="let object of data.objects" [value]="object">
                {{ getObjectDisplayName(object) }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="scheduleForm.get('object')?.hasError('required')">
              Location is required
            </mat-error>
          </mat-form-field>

          <!-- Employee Selection -->
          <mat-form-field>
            <mat-label>Employees</mat-label>
            <mat-select
              formControlName="employees"
              multiple
              [compareWith]="compareObjects"
            >
              <mat-option
                *ngFor="let employee of data.employees"
                [value]="employee"
              >
                {{ getEmployeeDisplayName(employee) }}
              </mat-option>
            </mat-select>
            <mat-error
              *ngIf="scheduleForm.get('employees')?.hasError('required')"
            >
              At least one employee is required
            </mat-error>
          </mat-form-field>

          <!-- Contract Selection -->
          <mat-form-field>
            <mat-label>Customer Contract</mat-label>
            <mat-select
              formControlName="customerContract"
              [compareWith]="compareObjects"
            >
              <mat-option [value]="">None</mat-option>
              <mat-option
                *ngFor="let contract of data.contracts"
                [value]="contract"
              >
                {{ getContractDisplayName(contract) }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Date and Time -->
          <mat-form-field>
            <mat-label>Date</mat-label>
            <input
              matInput
              [matDatepicker]="picker"
              formControlName="scheduledDate"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error
              *ngIf="scheduleForm.get('scheduledDate')?.hasError('required')"
            >
              Date is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Start Time</mat-label>
            <input
              matInput
              formControlName="startTime"
              required
              placeholder="09:00"
              maxlength="5"
              (input)="onTimeInput($event, 'startTime')"
              (blur)="validateTimeFormat('startTime')"
            />
            <mat-icon matSuffix>access_time</mat-icon>
            <mat-hint>Format: HH:MM (e.g., 09:00, 14:30)</mat-hint>
            <mat-error
              *ngIf="scheduleForm.get('startTime')?.hasError('required')"
            >
              Start time is required
            </mat-error>
            <mat-error
              *ngIf="scheduleForm.get('startTime')?.hasError('invalidTime')"
            >
              Please enter a valid time format (HH:MM)
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>End Time</mat-label>
            <input
              matInput
              formControlName="endTime"
              required
              placeholder="17:00"
              maxlength="5"
              (input)="onTimeInput($event, 'endTime')"
              (blur)="validateTimeFormat('endTime')"
            />
            <mat-icon matSuffix>access_time</mat-icon>
            <mat-hint>Format: HH:MM (e.g., 17:00, 22:30)</mat-hint>
            <mat-error
              *ngIf="scheduleForm.get('endTime')?.hasError('required')"
            >
              End time is required
            </mat-error>
            <mat-error
              *ngIf="scheduleForm.get('endTime')?.hasError('invalidTime')"
            >
              Please enter a valid time format (HH:MM)
            </mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Estimated Duration (hours)</mat-label>
            <input
              matInput
              type="number"
              formControlName="estimatedDuration"
              min="0.5"
              step="0.5"
            />
            <mat-hint
              >Duration will auto-calculate based on start and end
              times</mat-hint
            >
            <mat-error
              *ngIf="
                scheduleForm.get('estimatedDuration')?.hasError('required')
              "
            >
              Duration is required
            </mat-error>
            <mat-error
              *ngIf="scheduleForm.get('estimatedDuration')?.hasError('min')"
            >
              Duration must be at least 0.5 hours
            </mat-error>
          </mat-form-field>

          <!-- Status and Priority -->
          <mat-form-field>
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
              <mat-option value="Scheduled">Scheduled</mat-option>
              <mat-option value="In Progress">In Progress</mat-option>
              <mat-option value="Completed">Completed</mat-option>
              <mat-option value="Cancelled">Cancelled</mat-option>
              <mat-option value="No Show">No Show</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Priority</mat-label>
            <mat-select formControlName="priority">
              <mat-option value="Low">Low</mat-option>
              <mat-option value="Medium">Medium</mat-option>
              <mat-option value="High">High</mat-option>
              <mat-option value="Urgent">Urgent</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Cleaning Type</mat-label>
            <mat-select formControlName="cleaningType">
              <mat-option value="Regular">Regular</mat-option>
              <mat-option value="Deep Clean">Deep Clean</mat-option>
              <mat-option value="Move-in/Move-out">Move-in/Move-out</mat-option>
              <mat-option value="Emergency">Emergency</mat-option>
              <mat-option value="Special Event">Special Event</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Notes -->
          <mat-form-field class="full-width">
            <mat-label>Notes</mat-label>
            <textarea
              matInput
              formControlName="notes"
              rows="3"
              placeholder="Additional notes or special instructions..."
            ></textarea>
          </mat-form-field>
        </div>
      </mat-dialog-content>

      <mat-dialog-actions align="end">
        <button mat-button type="button" (click)="onCancel()">Cancel</button>
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!scheduleForm.valid"
        >
          {{ isEdit ? "Update" : "Create" }}
        </button>
      </mat-dialog-actions>
    </form>
  </div>
</div>
